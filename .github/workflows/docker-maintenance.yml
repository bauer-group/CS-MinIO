# =============================================================================
# Docker Maintenance - Auto-merge Dependabot PRs
# =============================================================================
# Automatically merges Dependabot PRs for Docker base image updates.
# After merge, the docker-release.yml workflow is triggered which:
# 1. Creates a semantic release
# 2. Builds and pushes the new Docker images (minio + minio-init)
#
# Flow:
# ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
# │  Dependabot     │────>│  PR Created     │────>│  Docker Build   │
# │  Finds Update   │     │  (base image)   │     │  Validates      │
# └─────────────────┘     └─────────────────┘     └────────┬────────┘
#                                                          │
#                                                          v
# ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
# │  New Release    │<────│  Auto-Merged    │<────│  All Checks     │
# │  + Docker Push  │     │  to main        │     │  Pass           │
# └─────────────────┘     └─────────────────┘     └─────────────────┘
# =============================================================================

name: "\U0001F527 Docker Maintenance"

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
    paths:
      - 'src/minio/Dockerfile'
      - 'src/minio-init/Dockerfile'

permissions:
  contents: write
  pull-requests: write

jobs:
  maintenance:
    name: Auto-merge Dependabot PRs
    uses: bauer-group/automation-templates/.github/workflows/docker-maintenance-dependabot.yml@main
    with:
      merge-method: 'squash'
      auto-approve: true
    secrets: inherit
