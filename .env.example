# =============================================================================
# MinIO - Environment Configuration
# =============================================================================
# S3-compatible object storage with automated initialization.
# Documentation: https://min.io/docs/minio/linux/reference/minio-server/settings/
# =============================================================================


# =============================================================================
# Stack Configuration
# =============================================================================

# Container name prefix (used for container names, volumes, networks)
STACK_NAME=s3_example_domain_com

# Container timezone
# Default: Etc/UTC
TIME_ZONE=Etc/UTC


# =============================================================================
# Image Configuration
# =============================================================================

# -----------------------------------------------------------------------------
# Production Images (Pre-built from GHCR)
# -----------------------------------------------------------------------------
# Used in docker-compose-single.yml and docker-compose-single-traefik.yml

# MinIO server image
MINIO_IMAGE=ghcr.io/bauer-group/cs-minio/minio
MINIO_VERSION=stable

# Init container image (bucket/user initialization)
MINIO_INIT_IMAGE=ghcr.io/bauer-group/cs-minio/minio-init
MINIO_INIT_VERSION=stable

# -----------------------------------------------------------------------------
# Build Images (Development / CI)
# -----------------------------------------------------------------------------
# Used for local Docker builds: docker compose build

# Official MinIO base image
BASE_MINIO_IMAGE=quay.io/minio/minio
BASE_MINIO_VERSION=RELEASE.2025-10-15T17-29-55Z


# =============================================================================
# MinIO Server Configuration
# =============================================================================

# Root credentials (REQUIRED - change these!)
# Generate password: openssl rand -base64 24
MINIO_ROOT_USER=admin
MINIO_ROOT_PASSWORD=CHANGE_ME_SECURE_PASSWORD

# Default region for bucket creation
# Common values: us-east-1, eu-west-1, eu-central-1
MINIO_REGION=us-east-1


# =============================================================================
# Network Configuration
# =============================================================================

# Private subnet octet for internal Docker network
# Creates: 10.25.{PRIVATESUBNET}.0/24 and fdfd:10:25:{PRIVATESUBNET}::/64
PRIVATESUBNET=254


# =============================================================================
# Port Settings (docker-compose-single.yml)
# =============================================================================
# Direct port binding when NOT using Traefik reverse proxy.

# S3 API port
EXPOSED_API_PORT=9000

# MinIO Console (Object Browser) port
EXPOSED_CONSOLE_PORT=9001


# =============================================================================
# Traefik Configuration (docker-compose-single-traefik.yml)
# =============================================================================
# DNS must resolve to these hostnames before starting.

# S3 API endpoint hostname
# Path-style access: https://{S3_HOSTNAME}/{bucket}/{key}
S3_HOSTNAME=s3.example.domain.com

# MinIO Console (Object Browser) hostname
S3_CONSOLE_HOSTNAME=s3-console.example.domain.com

# External Traefik network name (must already exist)
PROXY_NETWORK=EDGEPROXY

# DNS-style bucket access (optional)
# Requires wildcard certificate or explicit SANs for each bucket.
# Uncomment and add bucket hostnames if needed:
# S3_BUCKET_SANS=bucket1.s3.example.domain.com,bucket2.s3.example.domain.com


# =============================================================================
# Admin Console (Optional)
# =============================================================================
# Third-party admin console for full MinIO management.
# Required since MinIO removed built-in admin UI in RELEASE.2025-05-24.
#
# Image: ghcr.io/karlspace/minio-ui/minio-admin-console:latest
#
# Enable with: docker compose --profile admin-console up -d
#
# In single mode:  http://localhost:${ADMIN_CONSOLE_PORT}
# In traefik mode: https://${ADMIN_CONSOLE_HOSTNAME}

# Port for direct access (docker-compose-single.yml)
ADMIN_CONSOLE_PORT=9002

# Hostname for Traefik access (docker-compose-single-traefik.yml)
ADMIN_CONSOLE_HOSTNAME=s3-admin.example.domain.com

# Admin console credentials (created by init container)
# These are MinIO user credentials used to log in to the admin console.
# The user is created automatically by the init container with full admin privileges.
# Generate password: openssl rand -base64 24
ADMIN_CONSOLE_USER=console-admin
ADMIN_CONSOLE_PASSWORD=CHANGE_ME_SECURE_CONSOLE_PASSWORD


# =============================================================================
# Init Container Configuration
# =============================================================================
# The init container reads a JSON config file to declaratively provision:
# - Buckets (with versioning, quotas, retention, anonymous policy)
# - IAM Policies (custom S3 policy documents)
# - Groups (with policy attachments)
# - Users (with group membership and direct policy attachments)
# - Service Accounts (with explicit access key / secret key)
#
# JSON values support ${ENV_VAR} syntax for environment variable resolution.
# See config/minio-init.json for an example configuration.

# Path to JSON configuration file (bind-mounted into init container)
MINIO_INIT_CONFIG=./config/minio-init.json

# Timeout in seconds to wait for MinIO server to become healthy
MINIO_WAIT_TIMEOUT=60

# Application service account credentials (referenced in minio-init.json)
# Generate secret: openssl rand -base64 24
APP_SERVICE_SECRET_KEY=CHANGE_ME_APP_SERVICE_SECRET


# =============================================================================
# Deployment
# =============================================================================
#
# Single Mode (direct port access):
#   docker compose -f docker-compose-single.yml up -d
#   S3 API:  http://localhost:${EXPOSED_API_PORT}
#   Console: http://localhost:${EXPOSED_CONSOLE_PORT}
#
# Single Mode + Traefik (HTTPS):
#   docker compose -f docker-compose-single-traefik.yml up -d
#   S3 API:  https://${S3_HOSTNAME}
#   Console: https://${S3_CONSOLE_HOSTNAME}
#
# With Admin Console (append to any mode):
#   docker compose -f docker-compose-single.yml --profile admin-console up -d
#
