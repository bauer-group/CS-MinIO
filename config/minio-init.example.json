{
  "buckets": [
    {
      "name": "documents",
      "region": "eu-central-1",
      "versioning": true,
      "quota": { "type": "hard", "size": "10GB" },
      "policy": "private"
    },
    {
      "name": "backups",
      "region": "eu-central-1",
      "versioning": true,
      "object_lock": true,
      "retention": { "mode": "compliance", "days": 365 },
      "policy": "private"
    },
    {
      "name": "public-assets",
      "region": "eu-central-1",
      "policy": "public"
    },
    {
      "name": "uploads",
      "region": "eu-central-1",
      "versioning": true,
      "quota": { "type": "hard", "size": "50GB" },
      "policy": "private"
    }
  ],
  "policies": [
    {
      "name": "pDocumentsReadWrite",
      "statements": [
        {
          "Effect": "Allow",
          "Action": [
            "s3:GetObject",
            "s3:PutObject",
            "s3:DeleteObject",
            "s3:ListBucket",
            "s3:GetBucketLocation",
            "s3:ListMultipartUploadParts",
            "s3:AbortMultipartUpload"
          ],
          "Resource": [
            "arn:aws:s3:::documents",
            "arn:aws:s3:::documents/*"
          ]
        }
      ]
    },
    {
      "name": "pBackupsWriteOnly",
      "statements": [
        {
          "Effect": "Allow",
          "Action": [
            "s3:PutObject",
            "s3:GetBucketLocation",
            "s3:ListMultipartUploadParts",
            "s3:AbortMultipartUpload"
          ],
          "Resource": [
            "arn:aws:s3:::backups",
            "arn:aws:s3:::backups/*"
          ]
        }
      ]
    },
    {
      "name": "pPublicAssetsReadWrite",
      "statements": [
        {
          "Effect": "Allow",
          "Action": [
            "s3:GetObject",
            "s3:PutObject",
            "s3:DeleteObject",
            "s3:ListBucket",
            "s3:GetBucketLocation",
            "s3:ListMultipartUploadParts",
            "s3:AbortMultipartUpload"
          ],
          "Resource": [
            "arn:aws:s3:::public-assets",
            "arn:aws:s3:::public-assets/*"
          ]
        }
      ]
    },
    {
      "name": "pUploadsReadWrite",
      "statements": [
        {
          "Effect": "Allow",
          "Action": [
            "s3:GetObject",
            "s3:PutObject",
            "s3:DeleteObject",
            "s3:ListBucket",
            "s3:GetBucketLocation",
            "s3:ListMultipartUploadParts",
            "s3:AbortMultipartUpload",
            "s3:ListBucketMultipartUploads"
          ],
          "Resource": [
            "arn:aws:s3:::uploads",
            "arn:aws:s3:::uploads/*"
          ]
        }
      ]
    }
  ],
  "groups": [
    {
      "name": "gApplications",
      "policies": ["pDocumentsReadWrite", "pPublicAssetsReadWrite", "pUploadsReadWrite"]
    },
    {
      "name": "gBackupAgents",
      "policies": ["pBackupsWriteOnly"]
    }
  ],
  "users": [
    {
      "access_key": "${APP_USER}",
      "secret_key": "${APP_PASSWORD}",
      "groups": ["gApplications"]
    },
    {
      "access_key": "${BACKUP_USER}",
      "secret_key": "${BACKUP_PASSWORD}",
      "groups": ["gBackupAgents"]
    }
  ],
  "service_accounts": [
    {
      "user": "${APP_USER}",
      "name": "app-worker",
      "description": "Worker service account for document processing"
    },
    {
      "user": "${BACKUP_USER}",
      "name": "backup-agent",
      "description": "Automated backup agent",
      "policy": "pBackupsWriteOnly"
    }
  ]
}
